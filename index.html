<!DOCTYPE html>
<html>
<head>
    <title>Fancy Path Trace</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f8fafc; padding: 40px; }
        .card { max-width: 650px; margin: auto; background: #1a1f2e; padding: 30px; border-radius: 12px; border: 1px solid #2d3748; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #4a5568; background: #0f172a; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 14px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; }
        #log { margin-top: 25px; border-left: 3px solid #3b82f6; padding-left: 15px; font-size: 13px; color: #94a3b8; }
        .conclusion { margin-top: 20px; padding: 20px; background: #1e293b; border: 1px solid #f59e0b; border-radius: 8px; }
        .hop { background: #0f172a; padding: 12px; margin-top: 10px; border-radius: 6px; border-left: 4px solid #3b82f6; font-size: 13px; }
        .spam-note { font-size: 11px; background: #2d3748; padding: 8px; margin-top: 5px; border-radius: 4px; color: #94a3b8; }
        .tx-link { color: #60a5fa; font-family: monospace; font-size: 11px; text-decoration: none; word-break: break-all; }
    </style>
</head>
<body>
    <div class="card">
        <h2>⛓️ Blockchain Investigator</h2>
        <input id="addrA" placeholder="Source Wallet">
        <input id="addrB" placeholder="Target Wallet">
        <select id="maxHops">
            <option value="2">2 Hops (Direct/Common)</option>
            <option value="3">3 Hops (Intermediate)</option>
            <option value="4">4 Hops (Deep Trace)</option>
        </select>
        <button onclick="run()">Investigate</button>
        <div id="log"></div>
        <div id="result"></div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let transientLine = null;
        function run() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('result').innerHTML = '';
            transientLine = null;
            socket.emit('check-relationship', { addrA: document.getElementById('addrA').value.trim(), addrB: document.getElementById('addrB').value.trim(), maxHops: document.getElementById('maxHops').value });
        }
        socket.on('progress', (data) => {
            const log = document.getElementById('log');
            if (data.transient) {
                if (!transientLine) { transientLine = document.createElement('div'); log.appendChild(transientLine); }
                transientLine.innerText = "⏳ " + data.message;
            } else {
                transientLine = null;
                const d = document.createElement('div');
                d.innerHTML = "✅ " + data.message;
                log.appendChild(d);
            }
        });
        socket.on('conclusion', (data) => {
            const res = document.getElementById('result');
            let h = `<div class="conclusion"><h3>${data.status}</h3>`;
            data.evidence.forEach((ev, i) => {
                h += `<div class="hop"><strong>Step ${i+1}: ${ev.pair}</strong><br><a href="${ev.url}" target="_blank" class="tx-link">${ev.url}</a></div>`;
            });
            if (data.spamNotes.length > 0) {
                h += `<div style="margin-top:20px; font-size:12px; font-weight:bold; color:#ef4444;">⚠️ Potential Spam/Dust Senders Noted:</div>`;
                data.spamNotes.forEach(s => {
                    h += `<div class="spam-note">
                        <strong>Common Sender: ${s.address}</strong><br>
                        A Evidence: <a href="${s.urlA}" target="_blank" class="tx-link">Link A</a> |
                        B Evidence: <a href="${s.urlB}" target="_blank" class="tx-link">Link B</a>
                    </div>`;
                });
            }
            res.innerHTML = h + `</div>`;
        });
        socket.on('error', (msg) => alert("Error: " + msg));
    </script>
</body>
</html>
